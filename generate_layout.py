LGLS4 = "&kp LG(LS(NUMBER_4))"
LGLS5 = "&kp LG(LS(NUMBER_5))"
FN_SPACE = "&lt NBC SPACE"
CMD_F3 = "&mt LGUI F3"
REFRESH = "&kp C_AC_REFRESH"
MULTIPLY = "&kp KP_MULTIPLY"
LC_MINUS = "&kp LC(MINUS)"
LC_PLUS = "&kp LC(PLUS)"
LG_RIGHT = "&kp LG(RIGHT)"
LG_LEFT = "&kp LG(LEFT)"
LA_RIGHT = "&kp LA(RIGHT)"
LA_LEFT = "&kp LA(LEFT)"
LG_SPACE = "&kp LG(SPACE)"
VOL_UP = "&kp C_VOL_UP"
VOL_DOWN = "&kp C_VOL_DN"
BL_SEL_0 = "&bt BT_SEL 0"
BL_SEL_1 = "&bt BT_SEL 1"
BL_SEL_2 = "&bt BT_SEL 2"
USE_BLE = "&out OUT_BLE"
USE_USB = "&out OUT_USB"
BLE_CLR = "&bt BT_CLR"
EP_ON = "&ext_power EP_ON"
EP_OFF = "&ext_power EP_OFF"
Ns = [f"&kp NUMBER_{i}" for i in range(10)]

layers = {
    "default_layer": {
        "pound_define": "DFT",
        "bindings": f"""
    ┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓
    ┃ &kp TAB    ┃ &kp Q      ┃ &kp W      ┃ &kp E      ┃ &kp R      ┃ &kp T      ┃┃ &kp Y      ┃ &kp U      ┃ &kp I      ┃ &kp O      ┃ &kp P      ┃ &kp BSPC   ┃
    ┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫
    ┃ &mo NVW    ┃ &kp A      ┃ &kp S      ┃ &kp D      ┃ &kp F      ┃ &kp G      ┃┃ &kp H      ┃ &kp J      ┃ &kp K      ┃ &kp L      ┃ &kp SEMI   ┃ &kp SQT    ┃
    ┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫
    ┃ &kp LSHFT  ┃ &kp Z      ┃ &kp X      ┃ &kp C      ┃ &kp V      ┃ &kp B      ┃┃ &kp N      ┃ &kp M      ┃ &kp COMMA  ┃ &kp DOT    ┃ &kp FSLH   ┃ &kp ESC    ┃
    ┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛
                                           ┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓
                                           ┃ &kp LALT   ┃ {CMD_F3}   ┃ {FN_SPACE} ┃┃ &kp RET    ┃ &mo FU     ┃ &kp LCTRL  ┃
                                           ┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛
    """
    },
    "winmask_layer": {
        "pound_define": "WMK",
        "bindings": """
    ┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓
    ┃            ┃            ┃            ┃            ┃            ┃            ┃┃            ┃            ┃            ┃            ┃            ┃            ┃
    ┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫
    ┃ &mo NVM    ┃            ┃            ┃            ┃            ┃            ┃┃            ┃            ┃            ┃            ┃            ┃            ┃
    ┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫
    ┃            ┃            ┃            ┃            ┃            ┃            ┃┃            ┃            ┃            ┃            ┃            ┃            ┃
    ┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛
                                           ┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓
                                           ┃            ┃            ┃            ┃┃            ┃            ┃            ┃
                                           ┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛
    """
    },
    "numbrack_layer": {
        "pound_define": "NBC",
        "bindings": f"""
    ┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓
    ┃            ┃ &kp EXCL   ┃ &kp AT     ┃ &kp HASH   ┃ &kp DLLR   ┃&kp PRCNT   ┃┃ &kp CARET  ┃ &kp AMPS   ┃ {MULTIPLY} ┃ &kp LPAR   ┃ &kp RPAR   ┃ &kp BSPC   ┃
    ┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫
    ┃            ┃ {Ns[1]}    ┃ {Ns[2]}    ┃ {Ns[3]}    ┃ {Ns[4]}    ┃ {Ns[5]}    ┃┃ &kp MINUS  ┃ &kp EQUAL  ┃ &kp BSLH   ┃ &kp LBKT   ┃ &kp RBKT   ┃ &kp GRAVE  ┃
    ┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫
    ┃            ┃ {Ns[6]}    ┃ {Ns[7]}    ┃ {Ns[8]}    ┃ {Ns[9]}    ┃ {Ns[0]}    ┃┃ &kp UNDER  ┃ &kp PLUS   ┃ &kp PIPE   ┃ &kp LBRC   ┃ &kp RBRC   ┃ &kp TILDE  ┃
    ┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛
                                           ┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓
                                           ┃  &kp LGUI  ┃            ┃ &kp SPACE  ┃┃ &kp RET    ┃            ┃ &kp RALT   ┃
                                           ┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛
    """
    },
    "nav_win_layer": {
        "pound_define": "NVW",
        "bindings": f"""
    ┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓
    ┃            ┃ &kp C_PP   ┃ &kp C_PREV ┃ &kp C_NEXT ┃ &kp CAPS   ┃ {REFRESH}  ┃┃ &kp PG_UP  ┃ {LG_LEFT}  ┃ &kp UP     ┃ {LG_RIGHT} ┃ &kp PG_DN  ┃            ┃
    ┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫
    ┃ &mo NVM    ┃ {VOL_DOWN} ┃ {VOL_UP}   ┃ {LGLS4}    ┃ {LGLS5}    ┃            ┃┃ {LA_LEFT}  ┃ &kp LEFT   ┃ &kp DOWN   ┃ &kp RIGHT  ┃ {LA_RIGHT} ┃ &kp DEL    ┃
    ┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫
    ┃            ┃            ┃            ┃            ┃            ┃&tog WMK    ┃┃            ┃ {LC_MINUS} ┃            ┃ {LC_PLUS}  ┃            ┃            ┃
    ┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛
                                           ┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓
                                           ┃            ┃            ┃            ┃┃            ┃ &none      ┃            ┃
                                           ┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛
    """
    },
    "nav_mac_layer": {
        "pound_define": "NVM",
        "bindings": f"""
    ┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓
    ┃            ┃ &kp C_PP   ┃ &kp C_PREV ┃ &kp C_NEXT ┃ &kp CAPS   ┃ {REFRESH}  ┃┃ &kp PG_UP  ┃ &kp HOME   ┃ &kp UP     ┃ &kp END    ┃ &kp PG_DN  ┃            ┃
    ┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫
    ┃ &mo NVM    ┃ {VOL_DOWN} ┃ {VOL_UP}   ┃ {LGLS4}    ┃ {LGLS5}    ┃            ┃┃ {LG_LEFT}  ┃ &kp LEFT   ┃ &kp DOWN   ┃ &kp RIGHT  ┃ {LG_RIGHT} ┃ &kp DEL    ┃
    ┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫
    ┃            ┃            ┃            ┃            ┃            ┃ &tog WMK   ┃┃            ┃ {LC_MINUS} ┃            ┃ {LC_PLUS}  ┃            ┃            ┃
    ┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛
                                           ┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓
                                           ┃            ┃            ┃            ┃┃            ┃ &none      ┃            ┃
                                           ┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛
    """
    },
    "function_layer": {
        "pound_define": "FU",
        "bindings": f"""
    ┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓
    ┃ {EP_OFF}   ┃ {EP_OFF}   ┃            ┃            ┃            ┃            ┃┃ {BLE_CLR}  ┃            ┃ &kp UP     ┃            ┃ {USE_BLE}  ┃ {BL_SEL_0} ┃
    ┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫
    ┃ &kp F12    ┃ &kp F1     ┃ &kp F2     ┃ &kp F3     ┃ &kp F4     ┃ &kp F5     ┃┃            ┃ &kp LEFT   ┃ &kp DOWN   ┃ &kp RIGHT  ┃ {USE_USB}  ┃ {BL_SEL_1} ┃
    ┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫┣━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━╋━━━━━━━━━━━━┫
    ┃ &kp F11    ┃ &kp F6     ┃ &kp F7     ┃ &kp F8     ┃ &kp F9     ┃ &kp F10    ┃┃            ┃ {LC_MINUS} ┃            ┃ {LC_PLUS}  ┃            ┃ {BL_SEL_2} ┃
    ┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛
                                           ┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓┏━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━┓
                                           ┃ &kp F11    ┃ &kp RGUI   ┃ {LG_SPACE} ┃┃            ┃            ┃            ┃
                                           ┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛┗━━━━━━━━━━━━┻━━━━━━━━━━━━┻━━━━━━━━━━━━┛
    """
    },
}

def parse_layer_bindings(bindings):
    return "\n            ".join([line for i, line in enumerate(
                bindings.replace("┃            ", "  &trans     ").split("\n")
            ) if i in [2, 4, 6, 9]]).replace("┃", " ")

def parse_layer(name, bindings):
    return f"""
        {name} {{
            bindings = <
            {parse_layer_bindings(bindings)}
            >;
        }};"""

def get_layout():
    output = ''
    defs = []
    for i, (name, layer_dict) in enumerate(layers.items()):
        bindings = layer_dict['bindings']
        defs.append(f"#define {layer_dict['pound_define']} {i}")
        output += parse_layer(name, bindings)

    define_block = "\n".join(defs)
    return f"""
#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/ext_power.h>
#include <dt-bindings/zmk/outputs.h>

{define_block}

{{
    keymap {{
        compatible = "zmk,keymap";
        {output}
    }};
}};
    """

layout = get_layout()

with open("./config/corne.keymap", "w") as f:
    f.write(layout)